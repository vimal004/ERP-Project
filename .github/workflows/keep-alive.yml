name: Keep Backend Alive

on:
  schedule:
    # Ping every 14 minutes â€” Render sleeps after 15 min of inactivity
    # GitHub Actions cron only supports 5-minute minimum granularity
    - cron: '*/14 * * * *'
  workflow_dispatch: # Manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Render Backend
        run: |
          echo "Pinging backend to keep it alive..."
          # Try up to 3 times in case the first ping is waking it up
          for i in 1 2 3; do
            STATUS=$(curl -s -o /dev/null -w "%{http_code}" --max-time 120 https://erp-backend.onrender.com/actuator/health || true)
            echo "Attempt $i: HTTP $STATUS"
            if [ "$STATUS" = "200" ]; then
              echo "Backend is alive!"
              exit 0
            fi
            echo "Waiting 30s before retry..."
            sleep 30
          done
          echo "Backend did not respond after 3 attempts. It may be starting up."
